<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="/js-test-resources/js-test.js"></script>
</head>
<body>
<script>
    description("Test for enabling debug mode and that it permanently treats 3rdpartytestwebkit.org as a prevalent resource.");
    jsTestIsAsync = true;

    const thirdPartyOrigin = "http://3rdpartytestwebkit.org";

    function setEnableFeature(enable, completionHandler) {
        internals.setResourceLoadStatisticsEnabled(enable);
        testRunner.setStatisticsNotifyPagesWhenDataRecordsWereScanned(enable);
        testRunner.setCookieStoragePartitioningEnabled(enable);
        if (!enable)
            testRunner.statisticsResetToConsistentState(completionHandler);
        else
            completionHandler();
    }

    if (window.testRunner && window.internals) {
        setEnableFeature(true, function() {
            if (testRunner.isStatisticsPrevalentResource(thirdPartyOrigin))
                testFailed(thirdPartyOrigin + " already set as prevalent resource.");

            testRunner.setStatisticsDebugMode(true, function() {
                if (!testRunner.isStatisticsPrevalentResource(thirdPartyOrigin))
                    testFailed(thirdPartyOrigin + " didn't get set as prevalent resource.");
                else
                    testPassed(thirdPartyOrigin + " got set as prevalent resource in debug mode.");
                testRunner.setStatisticsDebugMode(false, function() {
                    setEnableFeature(false, finishJSTest);
                });
            });
        });
    }
</script>
</body>
</html>
