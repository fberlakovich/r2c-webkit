<!DOCTYPE html>
<html>
<head>
<script>
function log(message) {
    document.getElementById('console').innerHTML += (message + "\n");
}

function logMouseEvent(ev) {
    var target = (ev.target)? ev.target : ev.srcElement;
    var targetName = target.nodeName;
    if (target.id)
        targetName += "#" + target.id;
    log(ev.type + " on " + targetName);
}

function logMouseEventAndEnd(ev) {
    logMouseEvent(ev);
    log('PASS');
    if (window.testRunner)
        testRunner.notifyDone();
}

function timeoutAndEnd() {
    log('FAIL');
    if (window.testRunner)
        testRunner.notifyDone();
}

function doTest() {
    var div1 = document.getElementById('mydiv1');
    var div2 = document.getElementById('mydiv2');
    div1.addEventListener('mouseenter', logMouseEvent, false);
    div1.addEventListener('mouseleave', logMouseEvent, false);
    div2.addEventListener('mouseenter', logMouseEventAndEnd, false);
    div2.addEventListener('mouseleave', logMouseEvent, false);
    if (window.testRunner && window.eventSender) {
        eventSender.mouseMoveTo(50, 50);
        testRunner.dumpAsText();
        // The event is not emitted synchronously so we need to wait until we get it.
        testRunner.waitUntilDone();
        window.setTimeout(timeoutAndEnd, 300);
    }
    log('removing DIV#mydiv1');
    div1.parentNode.removeChild(div1);
}

</script>
</head>
<body onload="doTest()">
<div id=mydiv1 style="height:100px;"></div>
<div id=mydiv2 style="height:100px;"></div>
<p>This is a test that mouseenter/mouseleave events are emitted correctly when a hovered
element is removed from the document.
<pre id="console"></pre>
</body>
</html>
