<head>
<script>
function gc() {
    if (window.GCController)
        GCController.collect();
}

function numberOfLiveDocuments() {
    if (window.internals)
        return window.internals.numberOfLiveDocuments();
    return 1;
}

gc();

iterations = 10;
if (window.testRunner) {
    testRunner.dumpAsText();
    testRunner.waitUntilDone();
}

function test() {
    var f = document.getElementById("frame");
    f.onload = function() {
        f.contentDocument.open();
        f.contentDocument.close();
        --iterations;
        if (iterations)
            setTimeout("test()", 0);
        else {
            gc();
            var out = document.getElementById("out");
            out.innerText += "Number of live documents: " + numberOfLiveDocuments() + " (was " + numberOfLiveDocumentsAtStart + ")";
            if (window.testRunner)
                testRunner.notifyDone();
        }
    }
    f.setAttribute("src", "resources/apple.gif");
}

function begin() {
    numberOfLiveDocumentsAtStart = numberOfLiveDocuments();
    test();
}
</script>
</head>
<body onload="begin()">
    <p>Test that ImageDocuments don't leak their world. </p>
    <pre id="out"></pre>
    <iframe id="frame"></iframe>
</body>
