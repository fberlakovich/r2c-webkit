<!DOCTYPE html>
<script>

 var xmlns = "http://www.w3.org/2000/svg";

 function log(message) {
     var logDiv = document.getElementById('log');
     logDiv.appendChild(document.createTextNode(message));
 }

 function addRect()
 {
     var elem = document.createElementNS(xmlns, "rect");
     elem.setAttributeNS(null,"id", "rect");
     elem.setAttributeNS(null,"x",50);
     elem.setAttributeNS(null,"y",50);
     elem.setAttributeNS(null,"width",50);
     elem.setAttributeNS(null,"height",50);
     elem.setAttributeNS(null,"fill", "blue");

     document.getElementById("rootSVG").appendChild(elem);
 }

 function applyTransform()
 {
     var svgroot = document.getElementById("rootSVG");
     var transformList = document.getElementById("rect").transform.baseVal;
     var rotate = svgroot.createSVGTransform();
     rotate.setRotate(15,0,0);
     transformList.appendItem(rotate);
 }

 function removeRect()
 {
     document.getElementById("rootSVG").removeChild(document.getElementById("rect"));
 }

 var originalLiveElements = 0;

 function test()
 {
     if (!window.testRunner) {
         log("This test requires testRunner");
         return;
     }

     testRunner.dumpAsText();
     testRunner.waitUntilDone();

     GCController.collect();
     originalLiveElements = window.internals.numberOfLiveNodes();

     addRect();
     applyTransform();
     removeRect();

     GCController.collect();
     var delta = window.internals.numberOfLiveNodes() - originalLiveElements;
     if (delta == 0)
         log("PASS: all nodes were properly removed.");
     else
         log("FAIL: " + delta + " nodes leaked.")

     testRunner.notifyDone();
 }
</script>

<body onload="test()">
    <div id="log"></div>
    <svg id="rootSVG" width="300" height="300" xmlns="http://www.w3.org/2000/svg" version="1.1">
    </svg>
</body>
