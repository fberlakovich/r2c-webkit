2017-03-24  Antoine Quint  <graouts@webkit.org>

        [Modern Media Controls] Remove placard icon if height is compressed
        https://bugs.webkit.org/show_bug.cgi?id=167935
        <rdar://problem/30397128>

        Reviewed by Dean Jackson.

        We add a new test to check that the various designed constraints to toggle display of a placard's
        icon, title and description are honored. Also, due to the old layout() method now being called
        "commit()", we refactor a relevant test.

        * media/modern-media-controls/layout-node/node-made-dirty-during-commit-expected.txt: Added.
        * media/modern-media-controls/layout-node/node-made-dirty-during-commit.html: Added.
        * media/modern-media-controls/media-controls/media-controls-placard-compressed-metrics-expected.txt: Added.
        * media/modern-media-controls/media-controls/media-controls-placard-compressed-metrics.html: Added.

2017-03-24  Eric Carlson  <eric.carlson@apple.com>

        [MediaStream] "ideal" constraints passed to getUserMedia should affect fitness score
        https://bugs.webkit.org/show_bug.cgi?id=170056

        Reviewed by Youenn Fablet.

        * fast/mediastream/MediaStream-video-element-displays-buffer-expected.txt:
        * fast/mediastream/MediaStream-video-element-displays-buffer.html:
        * fast/mediastream/MediaStreamTrack-getCapabilities-expected.txt:
        * fast/mediastream/apply-constraints-advanced-expected.txt:
        * fast/mediastream/apply-constraints-advanced.html:
        * fast/mediastream/apply-constraints-video-expected.txt:
        * fast/mediastream/apply-constraints-video.html:

2017-03-24  Dean Jackson  <dino@apple.com>

        Serialization of custom props in longhand should be "" not value of shorthand
        https://bugs.webkit.org/show_bug.cgi?id=167699
        <rdar://problem/30324200>

        Reviewed by Sam Weinig.

        * fast/css/variables/rule-property-get-expected.html:
        * fast/css/variables/rule-property-get.html:

2017-03-24  Antoine Quint  <graouts@webkit.org>

        [Modern Media Controls] Captions don't move with the appearance of the inline controls
        https://bugs.webkit.org/show_bug.cgi?id=170051
        <rdar://problem/30754428>

        Reviewed by Dean Jackson.

        Add a new test, which would have previously failed, where we check that we account for the controls bar height
        when showing captions with the controls bar visible.

        * media/modern-media-controls/tracks-support/tracks-support-captions-offset-with-controls-bar-expected.txt: Added.
        * media/modern-media-controls/tracks-support/tracks-support-captions-offset-with-controls-bar.html: Added.

2017-03-24  Brent Fulgham  <bfulgham@apple.com>

        Handle recursive calls to ProcessingInstruction::checkStyleSheet
        https://bugs.webkit.org/show_bug.cgi?id=169982
        <rdar://problem/31083051>

        Reviewed by Antti Koivisto.

        * fast/dom/beforeload/image-removed-during-before-load-expected.txt: Copied from LayoutTests/fast/dom/beforeload/image-removed-during-before-load-expected.txt.
        * fast/dom/beforeload/image-removed-during-before-load.html: Copied from LayoutTests/fast/dom/beforeload/image-removed-during-before-load.html.
        * fast/dom/beforeload/recursive-css-pi-before-load-expected.txt: Copied from LayoutTests/fast/dom/beforeload/recursive-css-pi-before-load-expected.txt.
        * fast/dom/beforeload/recursive-css-pi-before-load.html: Copied from LayoutTests/fast/dom/beforeload/recursive-css-pi-before-load.html.
        * fast/dom/beforeload/recursive-link-before-load-expected.txt: Copied from LayoutTests/fast/dom/beforeload/recursive-link-before-load-expected.txt.
        * fast/dom/beforeload/recursive-link-before-load.html: Copied from LayoutTests/fast/dom/beforeload/recursive-link-before-load.html.
        * fast/dom/beforeload/recursive-xsl-pi-before-load-expected.txt: Copied from LayoutTests/fast/dom/beforeload/recursive-xsl-pi-before-load-expected.txt.
        * fast/dom/beforeload/recursive-xsl-pi-before-load.html: Copied from LayoutTests/fast/dom/beforeload/recursive-xsl-pi-before-load.html.
        * fast/dom/beforeload/resources/content.xhtml: Copied from LayoutTests/fast/dom/beforeload/resources/content.xhtml.
        * fast/dom/beforeload/resources/pass.css: Copied from LayoutTests/fast/dom/beforeload/resources/pass.css.
        * fast/dom/beforeload/resources/test.xsl: Copied from LayoutTests/fast/dom/beforeload/resources/test.xsl.

2017-03-24  Brady Eidson  <beidson@apple.com>

        A null compound index value crashes the Databases process.
        <rdar://problem/30499831> and https://bugs.webkit.org/show_bug.cgi?id=170000

        Reviewed by Alex Christensen.

        * storage/indexeddb/modern/resources/single-entry-index-invalid-key-crash.js: Added.
        * storage/indexeddb/modern/single-entry-index-invalid-key-crash-expected.txt: Added.
        * storage/indexeddb/modern/single-entry-index-invalid-key-crash-private-expected.txt: Added.
        * storage/indexeddb/modern/single-entry-index-invalid-key-crash-private.html: Added.
        * storage/indexeddb/modern/single-entry-index-invalid-key-crash.html: Added.

2017-03-24  Ryan Haddad  <ryanhaddad@apple.com>

        Skip svg/animations/animations-paused-when-inserted-in-hidden-document* tests on ios-simulator.
        https://bugs.webkit.org/show_bug.cgi?id=170068

        Unreviewed test gardening.

        * platform/ios-simulator/TestExpectations:

2017-03-24  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r214360.

        This change caused 20+ LayoutTest failures.

        Reverted changeset:

        "Handle recursive calls to
        ProcessingInstruction::checkStyleSheet"
        https://bugs.webkit.org/show_bug.cgi?id=169982
        http://trac.webkit.org/changeset/214360

2017-03-24  Youenn Fablet  <youenn@apple.com>

        Add support for qpSum in WebRTC stats
        https://bugs.webkit.org/show_bug.cgi?id=170060

        Reviewed by Eric Carlson.

        * webrtc/video-stats.html:

2017-03-24  Daniel Bates  <dabates@apple.com>

        Prevent new navigations during document unload
        https://bugs.webkit.org/show_bug.cgi?id=169934
        <rdar://problem/31247584>

        Reviewed by Chris Dumez.

        Add a test to ensure that we do not cause an assertion fail when calling setTimeout
        after starting a navigation from an onunload event handler.

        * fast/frames/frame-unload-navigate-and-setTimeout-assert-fail-expected.txt: Added.
        * fast/frames/frame-unload-navigate-and-setTimeout-assert-fail.html: Added.

2017-03-24  Myles C. Maxfield  <mmaxfield@apple.com>

        Implement font-optical-sizing
        https://bugs.webkit.org/show_bug.cgi?id=168895

        Reviewed by Dean Jackson.

        * fast/text/variations/optical-sizing-expected.txt: Added.
        * fast/text/variations/optical-sizing.html: Added.

2017-03-24  Yoav Weiss  <yoav@yoav.ws>

        Add a warning for unused link preloads.
        https://bugs.webkit.org/show_bug.cgi?id=165670

        Reviewed by Youenn Fablet.

        This adds a test for the unused preload warning, and adapts some of the other preload tests,
        to avoid warnings.

        * http/tests/preload/download_resources-expected.txt: Changed.
        * http/tests/preload/download_resources.html: Added references to preloaded resources.
        * http/tests/preload/onerrer_event-expected.txt: Changed.
        * http/tests/preload/onerror_event.html: Added references to preloaded resources.
        * http/tests/preload/onload_event.html: Added references to preloaded resources.
        * http/tests/preload/resources/single_download_preload.html: Deflaked.
        * http/tests/preload/unused_preload_warning-expected.txt: Added.
        * http/tests/preload/unused_preload_warning.html: Added.

2017-03-24  Brent Fulgham  <bfulgham@apple.com>

        Handle recursive calls to ProcessingInstruction::checkStyleSheet
        https://bugs.webkit.org/show_bug.cgi?id=169982
        <rdar://problem/31083051>

        Reviewed by Antti Koivisto.

        * fast/dom/beforeload/image-removed-during-before-load-expected.txt: Added.
        * fast/dom/beforeload/image-removed-during-before-load.html: Added.
        * fast/dom/beforeload/recursive-css-pi-before-load-expected.txt: Added.
        * fast/dom/beforeload/recursive-css-pi-before-load.html: Added.
        * fast/dom/beforeload/recursive-link-before-load-expected.txt: Added.
        * fast/dom/beforeload/recursive-link-before-load.html: Added.
        * fast/dom/beforeload/recursive-xsl-pi-before-load-expected.txt: Added.
        * fast/dom/beforeload/recursive-xsl-pi-before-load.html: Added.
        * fast/dom/beforeload/resources/content.xhtml: Added.
        * fast/dom/beforeload/resources/pass.css: Added.
        * fast/dom/beforeload/resources/test.xsl: Added.

2017-03-24  Myles C. Maxfield  <mmaxfield@apple.com>

        font-style needs a new CSSValue to make CSSRule.cssText work correctly
        https://bugs.webkit.org/show_bug.cgi?id=169258

        Reviewed by David Hyatt.

        Update tests' expected results.

        * fast/text/font-selection-font-face-parse-expected.txt:
        * fast/text/font-selection-font-face-parse.html:
        * fast/text/font-style-parse-expected.txt:
        * fast/text/font-style-parse.html:
        * platform/mac-elcapitan/fast/text/font-selection-font-face-parse-expected.txt:
        * svg/css/getComputedStyle-basic-expected.txt:

2017-03-24  Youenn Fablet  <youenn@apple.com>

        Add libwebrtc backend support for RTCRtpSender::replaceTrack
        https://bugs.webkit.org/show_bug.cgi?id=169841

        Reviewed by Alex Christensen.

        * webrtc/audio-replace-track-expected.txt: Added.
        * webrtc/audio-replace-track.html: Added.
        * webrtc/video-replace-track-expected.txt: Added.
        * webrtc/video-replace-track.html: Added.
        * webrtc/video-replace-track-to-null-expected.txt: Added.
        * webrtc/video-replace-track-to-null.html: Added.

2017-03-24  Ryan Haddad  <ryanhaddad@apple.com>

        Update TestExpectations for media/restore-from-page-cache.html.

        Unreviewed test gardening.

        * platform/mac-wk2/TestExpectations:
        * platform/mac/TestExpectations:

2017-03-24  Carlos Garcia Campos  <cgarcia@igalia.com>

        Unreviewed GTK+ gardening. Mark webrtc/video-stats.html as failing.

        * platform/gtk/TestExpectations:

2017-03-24  Youenn Fablet  <youenn@apple.com>

        Add support for DataChannel and MediaStreamTrack stats
        https://bugs.webkit.org/show_bug.cgi?id=170031

        Reviewed by Eric Carlson.

        * webrtc/datachannel/datachannel-stats-expected.txt: Added.
        * webrtc/datachannel/datachannel-stats.html: Added.
        * webrtc/video-mediastreamtrack-stats-expected.txt: Added.
        * webrtc/video-mediastreamtrack-stats.html: Added.

2017-03-24  Chris Dumez  <cdumez@apple.com>

        Extend svg/animations/animations-paused-disconnected-iframe.html
        https://bugs.webkit.org/show_bug.cgi?id=170035

        Reviewed by Andreas Kling.

        Extend svg/animations/animations-paused-disconnected-iframe.html to cover more things.

        * svg/animations/animations-paused-disconnected-iframe-expected.txt:
        * svg/animations/animations-paused-disconnected-iframe.html:

2017-03-24  Youenn Fablet  <youenn@apple.com>

        Fix framesEncoded/framesDecoded RTC stats
        https://bugs.webkit.org/show_bug.cgi?id=170024

        Reviewed by Eric Carlson.

        * webrtc/video-stats-expected.txt: Added.
        * webrtc/video-stats.html: Added.

2017-03-24  Carlos Garcia Campos  <cgarcia@igalia.com>

        Unreviewed GTK+ gardening. Mark media/video-load-require-user-gesture.html as failing after r214338.

        * platform/gtk/TestExpectations:

2017-03-24  Carlos Garcia Campos  <cgarcia@igalia.com>

        Unreviewed GTK+ gardening. Rebaseline http/tests/inspector/network/fetch-response-body.html/xhr-response-body.html after r214338.

        We are now getting the right application/json for a file data.json. The soup network backend tries to gess the
        mime type from the extension when sniffing is not allowed and the mime type is not known. See bug
        webkit.org/b/168299, that was added actually to fix these tests, but at that time we also failed to guess the
        mime type and returned application/octet-stream.

        * platform/gtk/TestExpectations:
        * platform/gtk/http/tests/inspector/network/fetch-response-body-expected.txt: Added.
        * platform/gtk/http/tests/inspector/network/xhr-response-body-expected.txt: Added.

2017-03-24  Carlos Garcia Campos  <cgarcia@igalia.com>

        Unreviewed GTK+ gardening. Rebaseline fast/dom/HTMLAnchorElement/anchor-file-blob-convert-to-download.html after r214338.

        We are now getting a MIME type for otf files.

        * platform/gtk/fast/dom/HTMLAnchorElement/anchor-file-blob-convert-to-download-expected.txt: Added.

2017-03-24  Per Arne Vollan  <pvollan@apple.com>

        Text stroke is sometimes clipped on video captions.
        https://bugs.webkit.org/show_bug.cgi?id=170006

        Reviewed by Eric Carlson.

        * media/track/track-css-stroke-cues-expected.txt:
        * media/track/track-css-stroke-cues.html:

2017-03-24  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Add MIMETypeRegistry implementation using xdgmime and remove the GTK+ one
        https://bugs.webkit.org/show_bug.cgi?id=170001

        Reviewed by Michael Catanzaro.

        Remove platform specific expectations of two test because now we do the same as other wk2 ports.

        * platform/gtk/TestExpectations:

2017-03-23  Antti Koivisto  <antti@apple.com>

        Revert r213712, caused iPad PLT regression
        https://bugs.webkit.org/show_bug.cgi?id=170040

        Unreviewed.

        * http/tests/incremental/stylesheet-body-incremental-rendering-expected.html: Removed.
        * http/tests/incremental/stylesheet-body-incremental-rendering.html: Removed.

2017-03-23  Chris Dumez  <cdumez@apple.com>

        SVG animations are not paused when their <svg> element is removed from the document
        https://bugs.webkit.org/show_bug.cgi?id=170030
        <rdar://problem/31230252>

        Reviewed by Dean Jackson.

        Add layout test coverage.

        * svg/animations/animations-paused-when-removed-from-document-expected.txt: Added.
        * svg/animations/animations-paused-when-removed-from-document.html: Added.

2017-03-22  Myles C. Maxfield  <mmaxfield@apple.com>

        font shorthand should accept variation values
        https://bugs.webkit.org/show_bug.cgi?id=168998

        Reviewed by Simon Fraser.

        * fast/text/font-style-parse-expected.txt:
        * fast/text/font-style-parse.html:
        * fast/text/font-weight-parse-expected.txt:
        * fast/text/font-weight-parse.html:

2017-03-23  Chris Dumez  <cdumez@apple.com>

        SVG animations are not paused when inserted into a hidden page
        https://bugs.webkit.org/show_bug.cgi?id=170026
        <rdar://problem/31228704>

        Reviewed by Andreas Kling.

        Add layout test coverage.

        * svg/animations/animations-paused-when-inserted-in-hidden-document-expected.txt: Added.
        * svg/animations/animations-paused-when-inserted-in-hidden-document.html: Added.
        * svg/animations/animations-paused-when-inserted-in-hidden-document2-expected.txt: Added.
        * svg/animations/animations-paused-when-inserted-in-hidden-document2.html: Added.

== Rolled over to ChangeLog-2017-03-23 ==
