2017-03-28  Andy Estes  <aestes@apple.com>

        [iOS] Crash in -[WebPreviewLoader failed] when running http/tests/multipart/policy-ignore-crash.php
        https://bugs.webkit.org/show_bug.cgi?id=170197
        <rdar://problem/30314067>

        Reviewed by Brady Eidson.

        * platform/ios/TestExpectations: Unskipped http/tests/multipart/policy-ignore-crash.php.
        * platform/ios/http/tests/multipart/policy-ignore-crash-expected.txt: Added an iOS-specific result.

2017-03-28  Chris Dumez  <cdumez@apple.com>

        Animated SVG images are not paused when outside viewport
        https://bugs.webkit.org/show_bug.cgi?id=170155
        <rdar://problem/31288893>

        Reviewed by Antti Koivisto.

        Add layout test coverage.

        * platform/mac-wk1/TestExpectations:
        * svg/animations/animated-svg-image-outside-viewport-paused-expected.txt: Added.
        * svg/animations/animated-svg-image-outside-viewport-paused.html: Added.
        * svg/animations/animated-svg-image-removed-from-document-paused-expected.txt: Added.
        * svg/animations/animated-svg-image-removed-from-document-paused.html: Added.
        * svg/animations/resources/smilAnimation.svg: Added.

2017-03-28  Antti Koivisto  <antti@apple.com>

        Missing render tree position invalidation when tearing down renderers for display:contents subtree
        https://bugs.webkit.org/show_bug.cgi?id=170199
        <rdar://problem/31260856>

        Reviewed by Zalan Bujtas.

        * fast/shadow-dom/slot-renderer-teardown-expected.txt: Added.
        * fast/shadow-dom/slot-renderer-teardown.html: Added.

2017-03-28  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r214485.

        This change caused LayoutTest crashes.

        Reverted changeset:

        "Stop RTCDataChannel when closing page"
        https://bugs.webkit.org/show_bug.cgi?id=170166
        http://trac.webkit.org/changeset/214485

2017-03-28  Brian Burg  <bburg@apple.com>

        Web Inspector: Add "Disable Caches" option that only applies to the inspected page while Web Inspector is open
        https://bugs.webkit.org/show_bug.cgi?id=169865
        <rdar://problem/31250573>

        Reviewed by Joseph Pecoraro.

        Add tests that verify the new command works as expected when it disables resource caching.
        I also manually verified that the override setting is cleared when Web Inspector disconnects.
        This is not easy to check in a layout test since we rely on the Web Inspector to tell whether
        a load happened or not.

        * http/tests/inspector/network/set-resource-caching-disabled-disk-cache-expected.txt: Added.
        * http/tests/inspector/network/set-resource-caching-disabled-disk-cache.html: Added.
        * http/tests/inspector/network/set-resource-caching-disabled-memory-cache-expected.txt: Added.
        * http/tests/inspector/network/set-resource-caching-disabled-memory-cache.html: Added.

2017-03-28  Youenn Fablet  <youenn@apple.com>

        Update LayoutTests/fast/mediastream/RTCPeerConnection-addIceCandidate.html to get more coverage
        https://bugs.webkit.org/show_bug.cgi?id=170194

        Reviewed by Chris Dumez.

        * fast/mediastream/RTCPeerConnection-addIceCandidate-expected.txt:
        * fast/mediastream/RTCPeerConnection-addIceCandidate.html: Making test more robust to failures to get more coverage.

2017-03-28  Joseph Pecoraro  <pecoraro@apple.com>

        Web Inspector: Inspecting a Main Resource that is JS/JSON does not format / syntax highlight it properly
        https://bugs.webkit.org/show_bug.cgi?id=166862
        <rdar://problem/29835977>

        Reviewed by Brian Burg.

        * http/tests/inspector/network/resource-mime-type-expected.txt: Added.
        * http/tests/inspector/network/resource-mime-type.html: Added.
        Test resource mime types for different resources.

        * http/tests/inspector/network/resources/json.php: Added.
        * http/tests/inspector/network/resources/script.js: Added.
        * http/tests/inspector/network/resources/script.txt: Added.
        * http/tests/inspector/network/resources/stylesheet.css: Added.
        * http/tests/inspector/network/resources/stylesheet.txt: Added.
        * http/tests/resources/square20.jpg: Added.
        Resources for various requests and different mime types.

2017-03-28  Ryan Haddad  <ryanhaddad@apple.com>

        Mark http/tests/xmlhttprequest/simple-cross-origin-progress-events.html as flaky.
        https://bugs.webkit.org/show_bug.cgi?id=168132

        Unreviewed test gardening.

        * platform/mac/TestExpectations:

2017-03-28  Ryan Haddad  <ryanhaddad@apple.com>

        Mark two fast/scrolling/ios/touch-scroll tests as failing.
        https://bugs.webkit.org/show_bug.cgi?id=170153

        Unreviewed test gardening.

        * platform/ios-wk2/TestExpectations:

2017-03-28  Ryan Haddad  <ryanhaddad@apple.com>

        Remove failure expectation for media/modern-media-controls/media-controller/media-controller-scale-factor-audio.html.

        Unreviewed test gardening.

        * platform/ios/TestExpectations:

2017-03-28  Youenn Fablet  <youenn@apple.com>

        Stop RTCDataChannel when closing page
        https://bugs.webkit.org/show_bug.cgi?id=170166

        Reviewed by Eric Carlson.

        * webrtc/datachannel/datachannel-gc-expected.txt: Added.
        * webrtc/datachannel/datachannel-gc.html: Added.

2017-03-28  Antoine Quint  <graouts@apple.com>

        REGRESSION (r214386): [ios-simulator] LayoutTest media/modern-media-controls/media-controller/media-controller-scale-factor-audio.html is failing
        https://bugs.webkit.org/show_bug.cgi?id=170180

        Unreviewed. Restore a value that was mistakenly changed in the fix for webkit.org/b/169962.

        * media/modern-media-controls/media-controller/media-controller-scale-factor-audio-expected.txt:
        * media/modern-media-controls/media-controller/media-controller-scale-factor-audio.html:

2017-03-28  Ryan Haddad  <ryanhaddad@apple.com>

        Mark fast/history/ios/history-scroll-restoration.html as flaky.
        https://bugs.webkit.org/show_bug.cgi?id=169558

        Unreviewed test gardening.

        * platform/ios-wk2/TestExpectations:

2017-03-28  Ryan Haddad  <ryanhaddad@apple.com>

        Mark media/modern-media-controls/media-controller/media-controller-scale-factor-audio.html as failing on ios-simulator.
        https://bugs.webkit.org/show_bug.cgi?id=170180

        Unreviewed test gardening.

        * platform/ios/TestExpectations:

2017-03-28  Youenn Fablet  <youenn@apple.com>

        LayoutTest webrtc/video-getParameters.html is failing
        https://bugs.webkit.org/show_bug.cgi?id=170148

        Unreviewed.

        * TestExpectations: Marking webrtc/video-getParameters.html as failing.

2017-03-28  Ryan Haddad  <ryanhaddad@apple.com>

        Mark webrtc/video-replace-track-to-null.html as flaky.
        https://bugs.webkit.org/show_bug.cgi?id=170178

        Unreviewed test gardening.

        * TestExpectations:

2017-03-28  Jonathan Bedard  <jbedard@apple.com>

        Moved gardened ios-simulator tests to ios folders
        <rdar://problem/30948691>

        Unreviewed test re-organization.

        Moving ios-simulator test expectations to share as many expectations
        as possible with on-device testing.

        * platform/ios: Moved from platform/ios-simulator.
        * platform/ios-device: Added.
        * platform/ios-device-wk1: Added.
        * platform/ios-device-wk2: Added.
        * platform/ios-simulator: Moved to platform/ios.
        * platform/ios-simulator-wk1: Moved to platform/ios-wk1.
        * platform/ios-simulator-wk2: Moved to platform/ios-wk2.
        * platform/ios-wk1: Moved from platform/ios-simulator-wk1.
        * platform/ios-wk2: Moved from platform/ios-simulator-wk2.

2017-03-28  Yoav Weiss  <yoav@yoav.ws>

        Add a warning for unused link preloads.
        https://bugs.webkit.org/show_bug.cgi?id=165670

        Reviewed by Youenn Fablet.

        * TestExpectations: Added a "Failure Pass" for the flaky charset header test.
        * http/tests/preload/download_resources-expected.txt:
        * http/tests/preload/download_resources.html: Added references to preloaded resources.
        * http/tests/preload/onerror_event-expected.txt:
        * http/tests/preload/onerror_event.html: Added references to preloaded resources.
        * http/tests/preload/onload_event-expected.txt:
        * http/tests/preload/onload_event.html: Added references to preloaded resources.
        * http/tests/preload/single_download_preload.html: Deflaked.
        * http/tests/preload/single_download_preload_headers.php: Removed the charset to avoid double download bug.
        * http/tests/preload/single_download_preload_headers_charset-expected.txt: Added.
        * http/tests/preload/single_download_preload_headers_charset.php: Flaky test showing the double download bug when charset is declared.
        * http/tests/preload/unused_preload_warning-expected.txt: Added.
        * http/tests/preload/unused_preload_warning.html: Added.

2017-03-28  Antoine Quint  <graouts@apple.com>

        REGRESSION: Double-clicking the captions button while the captions popover is open prevents the popover from being opened again
        https://bugs.webkit.org/show_bug.cgi?id=170171
        <rdar://problem/31095500>

        Reviewed by Dean Jackson.

        Adding a new test that runs the steps to reproduce the issue, and rebaselining an existing one now that
        the "presented" property returns false immediately after calling hide() on the panel.

        * media/modern-media-controls/tracks-panel/tracks-panel-hide-expected.txt:
        * media/modern-media-controls/tracks-panel/tracks-panel-hide.html:
        * media/modern-media-controls/tracks-support/tracks-support-show-panel-then-double-click-on-tracks-button-expected.txt: Added.
        * media/modern-media-controls/tracks-support/tracks-support-show-panel-then-double-click-on-tracks-button.html: Added.

2017-03-28  Aaron Chu  <aaron_chu@apple.com>

        AX: Media controls should be able to be re-activated after faded away
        https://bugs.webkit.org/show_bug.cgi?id=170048
        <rdar://problem/30157179>

        Reviewed by Antoine Quint.

        * media/modern-media-controls/media-controls/media-controls-appear-when-focus-expected.txt: Added.
        * media/modern-media-controls/media-controls/media-controls-appear-when-focus.html: Added.

2017-03-28  Antoine Quint  <graouts@apple.com>

        [Modern Media Controls] Improve media documents across macOS, iPhone and iPad
        https://bugs.webkit.org/show_bug.cgi?id=169145
        <rdar://problem/17048858>

        Reviewed by Dean Jackson.

        We add new tests for media documents and related features that cover the following cases:
        
            - checking <video> with only audio tracks does not show the fullscreen button
            - checking <video> with only audio tracks does not show the picture-in-picture button
            - checking the size used in media documents for audio and video across macOS, iPhone and iPad

        * media/modern-media-controls/fullscreen-support/fullscreen-support-disabled-video-with-audio-tracks-only-expected.txt: Added.
        * media/modern-media-controls/fullscreen-support/fullscreen-support-disabled-video-with-audio-tracks-only.html: Added.
        * media/modern-media-controls/media-documents/ipad/media-document-audio-ios-sizing-expected.txt: Added.
        * media/modern-media-controls/media-documents/ipad/media-document-audio-ios-sizing.html: Added.
        * media/modern-media-controls/media-documents/ipad/media-document-video-ios-sizing-expected.txt: Added.
        * media/modern-media-controls/media-documents/ipad/media-document-video-ios-sizing.html: Added.
        * media/modern-media-controls/media-documents/media-document-audio-ios-sizing-expected.txt: Added.
        * media/modern-media-controls/media-documents/media-document-audio-ios-sizing.html: Added.
        * media/modern-media-controls/media-documents/media-document-audio-mac-sizing-expected.txt: Added.
        * media/modern-media-controls/media-documents/media-document-audio-mac-sizing.html: Added.
        * media/modern-media-controls/media-documents/media-document-video-ios-sizing-expected.txt: Added.
        * media/modern-media-controls/media-documents/media-document-video-ios-sizing.html: Added.
        * media/modern-media-controls/media-documents/media-document-video-mac-sizing-expected.txt: Added.
        * media/modern-media-controls/media-documents/media-document-video-mac-sizing.html: Added.
        * media/modern-media-controls/pip-support/pip-support-disabled-video-with-audio-tracks-only-expected.txt: Added.
        * media/modern-media-controls/pip-support/pip-support-disabled-video-with-audio-tracks-only.html: Added.
        * platform/ios-simulator/TestExpectations:
        * platform/mac/TestExpectations:

2017-03-27  Said Abou-Hallawa  <sabouhallawa@apple.com>

        REGRESSION(213764): Large images should not be decoded asynchronously when they are drawn on a canvas
        https://bugs.webkit.org/show_bug.cgi?id=169771

        Reviewed by Simon Fraser.

        * fast/images/animated-image-different-dest-size-expected.html: Added.
        * fast/images/animated-image-different-dest-size.html: Added.
        This test crashes without this patch.

        * fast/images/animated-image-loop-count.html:
        Clear the memory cache so the test can be not flaky. Running it with -repeat-each was failing.

        * fast/images/async-image-background-image-expected.html: Added.
        * fast/images/async-image-background-image.html: Added.
        Ensures the background image can be drawn asynchronously if it is large.

        * fast/images/async-image-canvas-draw-image-expected.html: Added.
        * fast/images/async-image-canvas-draw-image.html: Added.
        Ensures the image is drawn synchronously on the canvas regardless of its size.

        * fast/images/ordered-animated-image-frames.html:
        Clear the memory cache so the test can be not flaky. Running it with -repeat-each was failing.

        * fast/images/reset-image-animation-expected.txt:
        * fast/images/reset-image-animation.html:
        Change how the steps of the test are ordered so the test can be not flaky.
        Running it with -repeat-each was failing.

        * fast/images/resources/red-green-blue-900-300.png: Added.

2017-03-27  Youenn Fablet  <youenn@apple.com>

        addIceCandidate should not throw if passed null or undefined
        https://bugs.webkit.org/show_bug.cgi?id=170118

        Reviewed by Eric Carlson.

        Updating test to log addIceCandidate rejection.

        * webrtc/datachannel/basic.html:
        * webrtc/routines.js:
        (iceCallback1):
        (iceCallback2):
        (onAddIceCandidateError):

2017-03-27  Ryan Haddad  <ryanhaddad@apple.com>

        Rebaseline svg/css/getComputedStyle-basic.xhtml for macOS.

        Unreviewed test gardening.

        * platform/mac-elcapitan/svg/css/getComputedStyle-basic-expected.txt: Added.
        * platform/mac/svg/css/getComputedStyle-basic-expected.txt: Added.

2017-03-27  Antti Koivisto  <antti@apple.com>

        Loading in-body stylesheets should not block rendering of elements before them
        https://bugs.webkit.org/show_bug.cgi?id=169345

        Reviewed by Simon Fraser.

        * http/tests/incremental/resources/delayed-css.php: Added.
        * http/tests/incremental/stylesheet-body-incremental-rendering-expected.html: Added.
        * http/tests/incremental/stylesheet-body-incremental-rendering.html: Added.

2017-03-27  Myles C. Maxfield  <mmaxfield@apple.com>

        Test variation font ranges in the CSS Font Loading API
        https://bugs.webkit.org/show_bug.cgi?id=170022

        Reviewed by Dean Jackson.

        * fast/text/variations/font-loading-api-parse-ranges-expected.txt: Added.
        * fast/text/variations/font-loading-api-parse-ranges.html: Added.

2017-03-27  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r214411.

        Two of the LayoutTests for this change time out on ios-
        simulator.

        Reverted changeset:

        "[Modern Media Controls] Improve media documents across macOS,
        iPhone and iPad"
        https://bugs.webkit.org/show_bug.cgi?id=169145
        http://trac.webkit.org/changeset/214411

2017-03-27  Antoine Quint  <graouts@apple.com>

        [Modern Media Controls] Clicking on the tracks button when the tracks panel is up in a media document pauses the video
        https://bugs.webkit.org/show_bug.cgi?id=168517
        <rdar://problem/30577636>

        Reviewed by Dean Jackson.

        * media/video-click-dblckick-standalone.html: We disable modern-media-controls here since we know that this test won't pass with them on.

2017-03-27  Ryan Haddad  <ryanhaddad@apple.com>

        Mark media/modern-media-controls/time-label/time-label-white-space-nowrap.html as flaky.
        https://bugs.webkit.org/show_bug.cgi?id=169679

        Unreviewed test gardening.

        * platform/mac/TestExpectations:

2017-03-27  Ryan Haddad  <ryanhaddad@apple.com>

        Mark inspector/dom-debugger/dom-breakpoints.html as flaky.
        https://bugs.webkit.org/show_bug.cgi?id=170127

        Unreviewed test gardening.

        * platform/mac/TestExpectations:

2017-03-27  Ryan Haddad  <ryanhaddad@apple.com>

        Mark media/modern-media-controls/time-label/time-label.html as flaky.
        https://bugs.webkit.org/show_bug.cgi?id=169678

        Unreviewed test gardening.

        * platform/mac-wk1/TestExpectations:

2017-03-27  Ryan Haddad  <ryanhaddad@apple.com>

        Marking two modern-media-controls tests as timeouts.
        https://bugs.webkit.org/show_bug.cgi?id=170123

        Unreviewed test gardening.

        * platform/ios-simulator/TestExpectations:

2017-03-27  Youenn Fablet  <youenn@apple.com>

        Tighten RTCDatachannel creation and parameter getters
        https://bugs.webkit.org/show_bug.cgi?id=170081

        Reviewed by Eric Carlson.

        * webrtc/datachannel/basic-expected.txt:
        * webrtc/datachannel/basic.html:

2017-03-27  Youenn Fablet  <youenn@apple.com>

        Add support for RTCRtpReceiver/RTCRtpSender getParameters
        https://bugs.webkit.org/show_bug.cgi?id=170057

        Reviewed by Alex Christensen.

        * webrtc/video-getParameters-expected.txt: Added.
        * webrtc/video-getParameters.html: Added.

2017-03-27  Myles C. Maxfield  <mmaxfield@apple.com>

        font variation properties don't need to accept numbers
        https://bugs.webkit.org/show_bug.cgi?id=169357

        Reviewed by Antti Koivisto.

        * fast/text/font-selection-font-face-parse-expected.txt:
        * fast/text/font-selection-font-face-parse.html:
        * fast/text/font-selection-font-loading-api-parse-expected.txt:
        * fast/text/font-selection-font-loading-api-parse.html:
        * fast/text/font-stretch-parse-expected.txt:
        * fast/text/font-stretch-parse.html:
        * fast/text/font-style-parse-expected.txt:
        * fast/text/font-style-parse.html:
        * fast/text/variations/font-selection-properties.html:
        * platform/mac-elcapitan/fast/text/font-selection-font-face-parse-expected.txt:

2017-03-27  Myles C. Maxfield  <mmaxfield@apple.com>

        Implement format specifier for variation fonts
        https://bugs.webkit.org/show_bug.cgi?id=169327

        Reviewed by Simon Fraser.

        * fast/text/variations/font-face-format-expected.html: Added.
        * fast/text/variations/font-face-format.html: Added.

2017-03-27  Myles C. Maxfield  <mmaxfield@apple.com>

        Make sure animation works for font-weight, font-stretch, and font-style
        https://bugs.webkit.org/show_bug.cgi?id=169683

        Reviewed by Simon Fraser.

        * animations/font-variations/font-stretch-expected.txt: Added.
        * animations/font-variations/font-stretch.html: Added.
        * animations/font-variations/font-style-expected.txt: Added.
        * animations/font-variations/font-style.html: Added.
        * animations/font-variations/font-weight-expected.txt: Added.
        * animations/font-variations/font-weight.html: Added.
        * animations/resources/animation-test-helpers.js:
        (compareFontStyle):
        (getPropertyValue):
        (comparePropertyValue):

2017-03-27  Alex Christensen  <achristensen@webkit.org>

        Make WebSockets work in network process
        https://bugs.webkit.org/show_bug.cgi?id=169930

        Reviewed by Youenn Fablet.

        * http/tests/websocket/tests/hybi/network-process-crash-error-expected.txt: Added.
        * http/tests/websocket/tests/hybi/network-process-crash-error.html: Added.
        * http/tests/websocket/tests/hybi/slow-reply_wsh.py: Added.
        (web_socket_do_extra_handshake):
        (web_socket_transfer_data):
        * platform/ios-simulator-wk1/TestExpectations:
        * platform/mac-wk1/TestExpectations:
        * platform/win/TestExpectations:

2017-03-27  Antoine Quint  <graouts@apple.com>

        [Modern Media Controls] Improve media documents across macOS, iPhone and iPad
        https://bugs.webkit.org/show_bug.cgi?id=169145
        <rdar://problem/17048858>

        Reviewed by Dean Jackson.

        We add new tests for media documents and related features that cover the following cases:
        
            - checking <video> with only audio tracks does not show the fullscreen button
            - checking <video> with only audio tracks does not show the picture-in-picture button
            - checking the size used in media documents for audio and video across macOS, iPhone and iPad

        * media/modern-media-controls/fullscreen-support/fullscreen-support-disabled-video-with-audio-tracks-only-expected.txt: Added.
        * media/modern-media-controls/fullscreen-support/fullscreen-support-disabled-video-with-audio-tracks-only.html: Added.
        * media/modern-media-controls/media-documents/ipad/media-document-audio-ios-sizing-expected.txt: Added.
        * media/modern-media-controls/media-documents/ipad/media-document-audio-ios-sizing.html: Added.
        * media/modern-media-controls/media-documents/ipad/media-document-video-ios-sizing-expected.txt: Added.
        * media/modern-media-controls/media-documents/ipad/media-document-video-ios-sizing.html: Added.
        * media/modern-media-controls/media-documents/media-document-audio-ios-sizing-expected.txt: Added.
        * media/modern-media-controls/media-documents/media-document-audio-ios-sizing.html: Added.
        * media/modern-media-controls/media-documents/media-document-audio-mac-sizing-expected.txt: Added.
        * media/modern-media-controls/media-documents/media-document-audio-mac-sizing.html: Added.
        * media/modern-media-controls/media-documents/media-document-video-ios-sizing-expected.txt: Added.
        * media/modern-media-controls/media-documents/media-document-video-ios-sizing.html: Added.
        * media/modern-media-controls/media-documents/media-document-video-mac-sizing-expected.txt: Added.
        * media/modern-media-controls/media-documents/media-document-video-mac-sizing.html: Added.
        * media/modern-media-controls/pip-support/pip-support-disabled-video-with-audio-tracks-only-expected.txt: Added.
        * media/modern-media-controls/pip-support/pip-support-disabled-video-with-audio-tracks-only.html: Added.
        * platform/ios-simulator/TestExpectations:
        * platform/mac/TestExpectations:

2017-03-25  Aaron Chu  <aaron_chu@apple.com>

        AX: Media controls are unlabeled
        https://bugs.webkit.org/show_bug.cgi?id=169947
        <rdar://problem/30153323>

        Reviewed by Antoine Quint.

        * media/modern-media-controls/airplay-button/airplay-button-expected.txt:
        * media/modern-media-controls/airplay-button/airplay-button.html:
        * media/modern-media-controls/forward-button/forward-button-expected.txt:
        * media/modern-media-controls/forward-button/forward-button.html:
        * media/modern-media-controls/fullscreen-button/fullscreen-button-expected.txt:
        * media/modern-media-controls/fullscreen-button/fullscreen-button.html:
        * media/modern-media-controls/icon-button/icon-button-expected.txt:
        * media/modern-media-controls/icon-button/icon-button.html:
        * media/modern-media-controls/icon-service/icon-service-expected.txt:
        * media/modern-media-controls/icon-service/icon-service.html:
        * media/modern-media-controls/mute-button/mute-button-expected.txt:
        * media/modern-media-controls/mute-button/mute-button.html:
        * media/modern-media-controls/pip-button/pip-button-expected.txt:
        * media/modern-media-controls/pip-button/pip-button.html:
        * media/modern-media-controls/play-pause-button/play-pause-button-expected.txt:
        * media/modern-media-controls/play-pause-button/play-pause-button.html:
        * media/modern-media-controls/rewind-button/rewind-button-expected.txt:
        * media/modern-media-controls/rewind-button/rewind-button.html:
        * media/modern-media-controls/skip-back-button/skip-back-button-expected.txt:
        * media/modern-media-controls/skip-back-button/skip-back-button.html:
        * media/modern-media-controls/start-button/start-button-expected.txt:
        * media/modern-media-controls/start-button/start-button.html:
        * media/modern-media-controls/tracks-button/tracks-button-expected.txt:
        * media/modern-media-controls/tracks-button/tracks-button.html:

2017-03-25  Carlos Garcia Campos  <cgarcia@igalia.com>

        Unreviewed GTK+ gardening. Update expectations of several tests.

        * platform/gtk/TestExpectations:

2017-03-25  Myles C. Maxfield  <mmaxfield@apple.com>

        Post-commit test fix after r214394
        https://bugs.webkit.org/show_bug.cgi?id=170083

        Unreviewed.

        * fast/text/variations/optical-sizing.html:

2017-03-24  Myles C. Maxfield  <mmaxfield@apple.com>

        Add font-optical-sizing to CSSComputedStyleDeclaration
        https://bugs.webkit.org/show_bug.cgi?id=170083

        Reviewed by Joseph Pecoraro.

        * fast/css/getComputedStyle/computed-style-expected.txt:
        * fast/css/getComputedStyle/computed-style-font-family-expected.txt:
        * fast/css/getComputedStyle/computed-style-without-renderer-expected.txt:
        * fast/css/getComputedStyle/resources/property-names.js:
        * fast/text/variations/optical-sizing-expected.txt:
        * fast/text/variations/optical-sizing.html:
        * platform/mac-elcapitan/fast/css/getComputedStyle/computed-style-expected.txt: Added.
        * platform/mac-elcapitan/fast/css/getComputedStyle/computed-style-font-family-expected.txt: Added.
        * platform/mac-elcapitan/fast/css/getComputedStyle/computed-style-without-renderer-expected.txt: Added.

2017-03-24  Ryan Haddad  <ryanhaddad@apple.com>

        Consolidate TestExpectations for media/restore-from-page-cache.html.

        Unreviewed test gardening.

        * platform/mac/TestExpectations:

2017-03-24  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r214361.

        This change caused flakiness in http/tests/preload tests.

        Reverted changeset:

        "Add a warning for unused link preloads."
        https://bugs.webkit.org/show_bug.cgi?id=165670
        http://trac.webkit.org/changeset/214361

2017-03-24  Antoine Quint  <graouts@webkit.org>

        [Modern Media Controls] Remove placard icon if height is compressed
        https://bugs.webkit.org/show_bug.cgi?id=167935
        <rdar://problem/30397128>

        Reviewed by Dean Jackson.

        We add a new test to check that the various designed constraints to toggle display of a placard's
        icon, title and description are honored. Also, due to the old layout() method now being called
        "commit()", we refactor a relevant test.

        * media/modern-media-controls/layout-node/node-made-dirty-during-commit-expected.txt: Added.
        * media/modern-media-controls/layout-node/node-made-dirty-during-commit.html: Added.
        * media/modern-media-controls/media-controls/media-controls-placard-compressed-metrics-expected.txt: Added.
        * media/modern-media-controls/media-controls/media-controls-placard-compressed-metrics.html: Added.

2017-03-24  Eric Carlson  <eric.carlson@apple.com>

        [MediaStream] "ideal" constraints passed to getUserMedia should affect fitness score
        https://bugs.webkit.org/show_bug.cgi?id=170056

        Reviewed by Youenn Fablet.

        * fast/mediastream/MediaStream-video-element-displays-buffer-expected.txt:
        * fast/mediastream/MediaStream-video-element-displays-buffer.html:
        * fast/mediastream/MediaStreamTrack-getCapabilities-expected.txt:
        * fast/mediastream/apply-constraints-advanced-expected.txt:
        * fast/mediastream/apply-constraints-advanced.html:
        * fast/mediastream/apply-constraints-video-expected.txt:
        * fast/mediastream/apply-constraints-video.html:

2017-03-24  Dean Jackson  <dino@apple.com>

        Serialization of custom props in longhand should be "" not value of shorthand
        https://bugs.webkit.org/show_bug.cgi?id=167699
        <rdar://problem/30324200>

        Reviewed by Sam Weinig.

        * fast/css/variables/rule-property-get-expected.html:
        * fast/css/variables/rule-property-get.html:

2017-03-24  Antoine Quint  <graouts@webkit.org>

        [Modern Media Controls] Captions don't move with the appearance of the inline controls
        https://bugs.webkit.org/show_bug.cgi?id=170051
        <rdar://problem/30754428>

        Reviewed by Dean Jackson.

        Add a new test, which would have previously failed, where we check that we account for the controls bar height
        when showing captions with the controls bar visible.

        * media/modern-media-controls/tracks-support/tracks-support-captions-offset-with-controls-bar-expected.txt: Added.
        * media/modern-media-controls/tracks-support/tracks-support-captions-offset-with-controls-bar.html: Added.

2017-03-24  Brent Fulgham  <bfulgham@apple.com>

        Handle recursive calls to ProcessingInstruction::checkStyleSheet
        https://bugs.webkit.org/show_bug.cgi?id=169982
        <rdar://problem/31083051>

        Reviewed by Antti Koivisto.

        * fast/dom/beforeload/image-removed-during-before-load-expected.txt: Copied from LayoutTests/fast/dom/beforeload/image-removed-during-before-load-expected.txt.
        * fast/dom/beforeload/image-removed-during-before-load.html: Copied from LayoutTests/fast/dom/beforeload/image-removed-during-before-load.html.
        * fast/dom/beforeload/recursive-css-pi-before-load-expected.txt: Copied from LayoutTests/fast/dom/beforeload/recursive-css-pi-before-load-expected.txt.
        * fast/dom/beforeload/recursive-css-pi-before-load.html: Copied from LayoutTests/fast/dom/beforeload/recursive-css-pi-before-load.html.
        * fast/dom/beforeload/recursive-link-before-load-expected.txt: Copied from LayoutTests/fast/dom/beforeload/recursive-link-before-load-expected.txt.
        * fast/dom/beforeload/recursive-link-before-load.html: Copied from LayoutTests/fast/dom/beforeload/recursive-link-before-load.html.
        * fast/dom/beforeload/recursive-xsl-pi-before-load-expected.txt: Copied from LayoutTests/fast/dom/beforeload/recursive-xsl-pi-before-load-expected.txt.
        * fast/dom/beforeload/recursive-xsl-pi-before-load.html: Copied from LayoutTests/fast/dom/beforeload/recursive-xsl-pi-before-load.html.
        * fast/dom/beforeload/resources/content.xhtml: Copied from LayoutTests/fast/dom/beforeload/resources/content.xhtml.
        * fast/dom/beforeload/resources/pass.css: Copied from LayoutTests/fast/dom/beforeload/resources/pass.css.
        * fast/dom/beforeload/resources/test.xsl: Copied from LayoutTests/fast/dom/beforeload/resources/test.xsl.

2017-03-24  Brady Eidson  <beidson@apple.com>

        A null compound index value crashes the Databases process.
        <rdar://problem/30499831> and https://bugs.webkit.org/show_bug.cgi?id=170000

        Reviewed by Alex Christensen.

        * storage/indexeddb/modern/resources/single-entry-index-invalid-key-crash.js: Added.
        * storage/indexeddb/modern/single-entry-index-invalid-key-crash-expected.txt: Added.
        * storage/indexeddb/modern/single-entry-index-invalid-key-crash-private-expected.txt: Added.
        * storage/indexeddb/modern/single-entry-index-invalid-key-crash-private.html: Added.
        * storage/indexeddb/modern/single-entry-index-invalid-key-crash.html: Added.

2017-03-24  Ryan Haddad  <ryanhaddad@apple.com>

        Skip svg/animations/animations-paused-when-inserted-in-hidden-document* tests on ios-simulator.
        https://bugs.webkit.org/show_bug.cgi?id=170068

        Unreviewed test gardening.

        * platform/ios-simulator/TestExpectations:

2017-03-24  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed, rolling out r214360.

        This change caused 20+ LayoutTest failures.

        Reverted changeset:

        "Handle recursive calls to
        ProcessingInstruction::checkStyleSheet"
        https://bugs.webkit.org/show_bug.cgi?id=169982
        http://trac.webkit.org/changeset/214360

2017-03-24  Youenn Fablet  <youenn@apple.com>

        Add support for qpSum in WebRTC stats
        https://bugs.webkit.org/show_bug.cgi?id=170060

        Reviewed by Eric Carlson.

        * webrtc/video-stats.html:

2017-03-24  Daniel Bates  <dabates@apple.com>

        Prevent new navigations during document unload
        https://bugs.webkit.org/show_bug.cgi?id=169934
        <rdar://problem/31247584>

        Reviewed by Chris Dumez.

        Add a test to ensure that we do not cause an assertion fail when calling setTimeout
        after starting a navigation from an onunload event handler.

        * fast/frames/frame-unload-navigate-and-setTimeout-assert-fail-expected.txt: Added.
        * fast/frames/frame-unload-navigate-and-setTimeout-assert-fail.html: Added.

2017-03-24  Myles C. Maxfield  <mmaxfield@apple.com>

        Implement font-optical-sizing
        https://bugs.webkit.org/show_bug.cgi?id=168895

        Reviewed by Dean Jackson.

        * fast/text/variations/optical-sizing-expected.txt: Added.
        * fast/text/variations/optical-sizing.html: Added.

2017-03-24  Yoav Weiss  <yoav@yoav.ws>

        Add a warning for unused link preloads.
        https://bugs.webkit.org/show_bug.cgi?id=165670

        Reviewed by Youenn Fablet.

        This adds a test for the unused preload warning, and adapts some of the other preload tests,
        to avoid warnings.

        * http/tests/preload/download_resources-expected.txt: Changed.
        * http/tests/preload/download_resources.html: Added references to preloaded resources.
        * http/tests/preload/onerrer_event-expected.txt: Changed.
        * http/tests/preload/onerror_event.html: Added references to preloaded resources.
        * http/tests/preload/onload_event.html: Added references to preloaded resources.
        * http/tests/preload/resources/single_download_preload.html: Deflaked.
        * http/tests/preload/unused_preload_warning-expected.txt: Added.
        * http/tests/preload/unused_preload_warning.html: Added.

2017-03-24  Brent Fulgham  <bfulgham@apple.com>

        Handle recursive calls to ProcessingInstruction::checkStyleSheet
        https://bugs.webkit.org/show_bug.cgi?id=169982
        <rdar://problem/31083051>

        Reviewed by Antti Koivisto.

        * fast/dom/beforeload/image-removed-during-before-load-expected.txt: Added.
        * fast/dom/beforeload/image-removed-during-before-load.html: Added.
        * fast/dom/beforeload/recursive-css-pi-before-load-expected.txt: Added.
        * fast/dom/beforeload/recursive-css-pi-before-load.html: Added.
        * fast/dom/beforeload/recursive-link-before-load-expected.txt: Added.
        * fast/dom/beforeload/recursive-link-before-load.html: Added.
        * fast/dom/beforeload/recursive-xsl-pi-before-load-expected.txt: Added.
        * fast/dom/beforeload/recursive-xsl-pi-before-load.html: Added.
        * fast/dom/beforeload/resources/content.xhtml: Added.
        * fast/dom/beforeload/resources/pass.css: Added.
        * fast/dom/beforeload/resources/test.xsl: Added.

2017-03-24  Myles C. Maxfield  <mmaxfield@apple.com>

        font-style needs a new CSSValue to make CSSRule.cssText work correctly
        https://bugs.webkit.org/show_bug.cgi?id=169258

        Reviewed by David Hyatt.

        Update tests' expected results.

        * fast/text/font-selection-font-face-parse-expected.txt:
        * fast/text/font-selection-font-face-parse.html:
        * fast/text/font-style-parse-expected.txt:
        * fast/text/font-style-parse.html:
        * platform/mac-elcapitan/fast/text/font-selection-font-face-parse-expected.txt:
        * svg/css/getComputedStyle-basic-expected.txt:

2017-03-24  Youenn Fablet  <youenn@apple.com>

        Add libwebrtc backend support for RTCRtpSender::replaceTrack
        https://bugs.webkit.org/show_bug.cgi?id=169841

        Reviewed by Alex Christensen.

        * webrtc/audio-replace-track-expected.txt: Added.
        * webrtc/audio-replace-track.html: Added.
        * webrtc/video-replace-track-expected.txt: Added.
        * webrtc/video-replace-track.html: Added.
        * webrtc/video-replace-track-to-null-expected.txt: Added.
        * webrtc/video-replace-track-to-null.html: Added.

2017-03-24  Ryan Haddad  <ryanhaddad@apple.com>

        Update TestExpectations for media/restore-from-page-cache.html.

        Unreviewed test gardening.

        * platform/mac-wk2/TestExpectations:
        * platform/mac/TestExpectations:

2017-03-24  Carlos Garcia Campos  <cgarcia@igalia.com>

        Unreviewed GTK+ gardening. Mark webrtc/video-stats.html as failing.

        * platform/gtk/TestExpectations:

2017-03-24  Youenn Fablet  <youenn@apple.com>

        Add support for DataChannel and MediaStreamTrack stats
        https://bugs.webkit.org/show_bug.cgi?id=170031

        Reviewed by Eric Carlson.

        * webrtc/datachannel/datachannel-stats-expected.txt: Added.
        * webrtc/datachannel/datachannel-stats.html: Added.
        * webrtc/video-mediastreamtrack-stats-expected.txt: Added.
        * webrtc/video-mediastreamtrack-stats.html: Added.

2017-03-24  Chris Dumez  <cdumez@apple.com>

        Extend svg/animations/animations-paused-disconnected-iframe.html
        https://bugs.webkit.org/show_bug.cgi?id=170035

        Reviewed by Andreas Kling.

        Extend svg/animations/animations-paused-disconnected-iframe.html to cover more things.

        * svg/animations/animations-paused-disconnected-iframe-expected.txt:
        * svg/animations/animations-paused-disconnected-iframe.html:

2017-03-24  Youenn Fablet  <youenn@apple.com>

        Fix framesEncoded/framesDecoded RTC stats
        https://bugs.webkit.org/show_bug.cgi?id=170024

        Reviewed by Eric Carlson.

        * webrtc/video-stats-expected.txt: Added.
        * webrtc/video-stats.html: Added.

2017-03-24  Carlos Garcia Campos  <cgarcia@igalia.com>

        Unreviewed GTK+ gardening. Mark media/video-load-require-user-gesture.html as failing after r214338.

        * platform/gtk/TestExpectations:

2017-03-24  Carlos Garcia Campos  <cgarcia@igalia.com>

        Unreviewed GTK+ gardening. Rebaseline http/tests/inspector/network/fetch-response-body.html/xhr-response-body.html after r214338.

        We are now getting the right application/json for a file data.json. The soup network backend tries to gess the
        mime type from the extension when sniffing is not allowed and the mime type is not known. See bug
        webkit.org/b/168299, that was added actually to fix these tests, but at that time we also failed to guess the
        mime type and returned application/octet-stream.

        * platform/gtk/TestExpectations:
        * platform/gtk/http/tests/inspector/network/fetch-response-body-expected.txt: Added.
        * platform/gtk/http/tests/inspector/network/xhr-response-body-expected.txt: Added.

2017-03-24  Carlos Garcia Campos  <cgarcia@igalia.com>

        Unreviewed GTK+ gardening. Rebaseline fast/dom/HTMLAnchorElement/anchor-file-blob-convert-to-download.html after r214338.

        We are now getting a MIME type for otf files.

        * platform/gtk/fast/dom/HTMLAnchorElement/anchor-file-blob-convert-to-download-expected.txt: Added.

2017-03-24  Per Arne Vollan  <pvollan@apple.com>

        Text stroke is sometimes clipped on video captions.
        https://bugs.webkit.org/show_bug.cgi?id=170006

        Reviewed by Eric Carlson.

        * media/track/track-css-stroke-cues-expected.txt:
        * media/track/track-css-stroke-cues.html:

2017-03-24  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK] Add MIMETypeRegistry implementation using xdgmime and remove the GTK+ one
        https://bugs.webkit.org/show_bug.cgi?id=170001

        Reviewed by Michael Catanzaro.

        Remove platform specific expectations of two test because now we do the same as other wk2 ports.

        * platform/gtk/TestExpectations:

2017-03-23  Antti Koivisto  <antti@apple.com>

        Revert r213712, caused iPad PLT regression
        https://bugs.webkit.org/show_bug.cgi?id=170040

        Unreviewed.

        * http/tests/incremental/stylesheet-body-incremental-rendering-expected.html: Removed.
        * http/tests/incremental/stylesheet-body-incremental-rendering.html: Removed.

2017-03-23  Chris Dumez  <cdumez@apple.com>

        SVG animations are not paused when their <svg> element is removed from the document
        https://bugs.webkit.org/show_bug.cgi?id=170030
        <rdar://problem/31230252>

        Reviewed by Dean Jackson.

        Add layout test coverage.

        * svg/animations/animations-paused-when-removed-from-document-expected.txt: Added.
        * svg/animations/animations-paused-when-removed-from-document.html: Added.

2017-03-22  Myles C. Maxfield  <mmaxfield@apple.com>

        font shorthand should accept variation values
        https://bugs.webkit.org/show_bug.cgi?id=168998

        Reviewed by Simon Fraser.

        * fast/text/font-style-parse-expected.txt:
        * fast/text/font-style-parse.html:
        * fast/text/font-weight-parse-expected.txt:
        * fast/text/font-weight-parse.html:

2017-03-23  Chris Dumez  <cdumez@apple.com>

        SVG animations are not paused when inserted into a hidden page
        https://bugs.webkit.org/show_bug.cgi?id=170026
        <rdar://problem/31228704>

        Reviewed by Andreas Kling.

        Add layout test coverage.

        * svg/animations/animations-paused-when-inserted-in-hidden-document-expected.txt: Added.
        * svg/animations/animations-paused-when-inserted-in-hidden-document.html: Added.
        * svg/animations/animations-paused-when-inserted-in-hidden-document2-expected.txt: Added.
        * svg/animations/animations-paused-when-inserted-in-hidden-document2.html: Added.

== Rolled over to ChangeLog-2017-03-23 ==
