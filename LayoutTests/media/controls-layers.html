<html>
<head>
    <script src="media-file.js"></script>
    <style>
        body {
            position: absolute;
            background-image: linear-gradient(white, silver);
        }
    </style>
    <script>
        if (window.testRunner)
            testRunner.dumpAsText();

        function doTest()
        {
            setSrcByTagName("audio", findMediaFile("audio", "content/test"));
            setSrcByTagName("video", findMediaFile("video", "content/test"));

            if (window.testRunner) {
                testRunner.waitUntilDone();
                setTimeout(function() { 
                    document.body.appendChild(document.createTextNode('FAIL')); 
                    if (window.testRunner)
                            testRunner.notifyDone();
                } , 8000);
            }

            var count = document.getElementsByTagName('audio').length + document.getElementsByTagName('video').length;
            document.addEventListener("canplaythrough", function () {
                if (!--count) {
                    if (window.testRunner) {
                        document.getElementById('layers').textContent = window.internals.layerTreeAsText(document);
                        testRunner.notifyDone();
                    }
                }
            }, true);
        }

        window.addEventListener('load', doTest, false);
    </script>
</head>
<body>
<video controls></video>
<audio controls></audio>
<pre id="layers"></pre>
</body>
</html>
