<html>
<head>
<script type="text/javascript" src="../../http/tests/inspector-protocol/resources/protocol-test.js"></script>
</head>
<body onLoad="runTest()">

<p>Checking Web Inspector protocol for the Accessibility Node Inspector.</p>

<!-- This one is never rendered, so "exists" should return false. -->
<script class="ex"></script>

<!-- The rest are rendered with various property differences. -->
<div class="ex"><div></div></div>
<div class="ex" role="presentation"><div></div></div>
<div class="ex"></div>
<span class="ex"></span>

<div class="ex" role="button" tabindex="0"></div>
<button class="ex"></button>
<input class="ex" type="button">

<input class="ex" required>
<input class="ex" aria-required="true">
<input class="ex" aria-invalid="spelling">
<input class="ex" aria-invalid="fake-value-will-eval-to-true">

<img class="ex" src="./404.gif">
<img class="ex" src="./404.gif" alt="">
<img class="ex" src="./404.gif" alt="x">

<script type="text/javascript">

function $(selector) {
    return document.querySelectorAll(selector);
}
function cleanup() {
    var examples = $(".ex");
    for (el in examples)
        el.style.display = "none";
}

function test() {

    var examples = [];

    function loop() {
        if (examples.length) {
            InspectorTest.sendCommand("DOM.getOuterHTML", {"nodeId": examples[examples.length-1]}, onGotOuterHTML);
        } else {
            InspectorTest.log("\n");
            InspectorTest.sendCommand("Runtime.evaluate", {"expression": "cleanup()"}, function(){
                InspectorTest.completeTest();
            });
        }
    };

    function onGotDocument(response) {
        InspectorTest.checkForError(response);
        InspectorTest.sendCommand("DOM.querySelectorAll", {"nodeId": response.result.root.nodeId, "selector": ".ex"}, onQuerySelectorAll);
    }

    function onQuerySelectorAll(response) {
        InspectorTest.checkForError(response);
        examples = response.result.nodeIds;
        InspectorTest.log("Total elements to be tested: " + examples.length + ".");
        loop();
    }

    function onGotOuterHTML(response) {
        InspectorTest.checkForError(response);
        InspectorTest.log("\n" + response.result.outerHTML.replace(" class=\"ex\"", ""));
        InspectorTest.sendCommand("DOM.getAccessibilityPropertiesForNode", {"nodeId": examples[examples.length-1]}, onGotAXProps);
    }

    function onGotAXProps(response) {
        InspectorTest.checkForError(response);
        for (prop in response.result.properties) {
            if (prop !== "nodeId")
                InspectorTest.log("    " + prop + ": " + response.result.properties[prop]);
        }
        examples.pop();
        loop();
    }

    InspectorTest.sendCommand("DOM.getDocument", {}, onGotDocument);

}
</script>
</body>
</html>
