From d95588908bbdd4ba6b0fab0b98d2dcedd73a7343 Mon Sep 17 00:00:00 2001
From: Zan Dobersek <zdobersek@igalia.com>
Date: Mon, 10 Jun 2019 09:09:48 +0200
Subject: [PATCH] view-backend-exportable-private: don't double-free callback
 resources during destruction.

---
 src/view-backend-exportable-private.cpp | 4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

diff --git a/src/view-backend-exportable-private.cpp b/src/view-backend-exportable-private.cpp
index 3a1559c..8a84359 100644
--- a/src/view-backend-exportable-private.cpp
+++ b/src/view-backend-exportable-private.cpp
@@ -38,9 +38,6 @@ ViewBackend::ViewBackend(ClientBundle* clientBundle, struct wpe_view_backend* ba
 
 ViewBackend::~ViewBackend()
 {
-    for (auto* resource : m_callbackResources)
-        wl_resource_destroy(resource);
-
     unregisterSurface(m_surfaceId);
 
     if (m_clientFd != -1)
@@ -119,6 +116,7 @@ void ViewBackend::unregisterSurface(uint32_t surfaceId)
     for (auto* resource : m_callbackResources)
         wl_resource_destroy(resource);
     m_callbackResources.clear();
+
     WS::Instance::singleton().unregisterViewBackend(m_surfaceId);
     m_surfaceId = 0;
 }
-- 
2.20.1

